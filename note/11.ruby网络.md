### net/http 库

基本使用1：

```ruby
require 'net/http'

Net::HTTP.start("www.baidu.com", use_ssl: false) do
  req = Net::HTTP::Get.new('/sitemap.xml')
  body = http.request(req).body
  puts body.force_encoding("UTF-8")
end
```

基本使用2：

URI.parse转字符串为URI对象

```ruby
require 'net/http'

url = URI.parse("https:www.qq.com/news")

Net::HTTP.start(url.host, url.port, use_ssl: true) do |http|
  req = Net::HTTP::Get.new(url.path)
  body = http.request(req).body
  puts body.force_encoding("UTF-8")
end
```

基本使用3：

get_response 简化上面的写法

```ruby
require 'net/http'

uri = URI.parse("https:www.qq.com/news")
response = Net::HTTP.get_response(uri)
puts response.body.force_encoding("UTF-8")
```

基本使用4：

按请求结果区分行为

当请求成功时，解析， 当请求被重定向时， 解析重定向地址

```ruby
require 'net/http'

def get_web_document(url)
  uri = URI.parse(url)
  response = Net::HTTP.get_response(uri)
  
  case response
  when Net::HTTPSuccess
    return response.body.force_encoding("UTF-8")
  when Net::HTTPRedirection
    return get_web_document(response['Location'])
  else
    return nil 
  end
end

puts get_web_document('https://www.apress.com/sitemap.xml')
puts get_web_document('https://www.apress.com/doesnotexist.xml')
puts get_web_document('https://ruby-doc.org/core')
```

基本使用5：

网络授权的例子, 在访问需要提供账号密码授权的场景， 可以使用basic_auth方法进行授权提交。

```ruby
require 'net/http'

url = URI.parse('http://browserspy.dk/password-ok.php')

Net::HTTP.start(url.host, url.port) do |http|
  req = Net::HTTP::Get.new(url.path)
  req.basic_auth('test','test')
  puts http.request(req).body
end
```

基本使用6：

通过表单提交数据1

```ruby
require 'net/http'

uri = URI.parse("www.bidu.com/create")
response = Net::HTTP.post_form(uri, {:username => 'zhangsan', :password => '2asdasd'})
puts response.body
```

基本使用7：

通过表单提交数据2：

不同于上面的直接Post形式， 提供更多的校验与附加信息提供的操作。

```ruby
require 'net/http'

uri = URI.parse('www,baiodu.com/create')
Net::HTTP.start(uri.host, uri.port) do |http|
  req = Net::HTTP.Post.new(url.path)
  req.set_form_data({:name => 'zhangsan', :age => 12})
  puts http.request(req).body
end
```

> 使用Proxy代理

基本使用8：

下方例子首先创建了一个Proxy代理实例， 然后通过代来进行请求

```ruby
web_proxy = Net::HTTP::Proxy('xxx.proxy.com', 8080)
url = URI.parse('https://www.naodix.ca/ax.xml')

web_proxy.start(url.host, url.port, use_ssl: true) do |http|
  req = Net::HTTP::Get.new(url.path)
  puts http.request(req).body.force_encoding("UTF-8")
end
```

基本使用9：

在按需来进行是否要代理请求的情况下， 可以判断执行

```ruby
require 'net/http'

http_class = ARGV.first ? Net::HTTP::Proxy(ARGV[0], ARGV[1]) : Net::HTTP
url = URI.parse('https://www.asd.com/st.xml')
response = http_class.get_response(url)

puts response.body.force_encoding("UTF-8")
```

> https

基本使用10

SSL： Secure Socket Layer。 直接见代码， 一见便知如何使用

```ruby
require 'net/http'

url = URI.parse("https://www.naodu.com/abc.xml")
http = Net::HTTP.new(url.host, url.port)
# 只要设置一下use_ssl即可
http.use_ssl = true if url.scheme == 'https'

request = Net::HTTP::Get.new(url.path)
puts http.request(request).body.force_encoding("UTF-8")
```

### Open-Uri 库

将ruby的 `net/http, net/https, net/ftp` 这几个库打包在一起的再封装， 用起来的感觉和Python很像. 该库是内置的

基本例子1：

```ruby
require 'open-uri'

# 网络请求的文件就跟本地一样轻松使用
f = open('https://abc.apress.com/sitemap.xml')
puts f.readlines.join
```

基本例子2：

由于HTTP， HTTPS， FTP三者之间底层都是同样的协议， 因此`open`方法不需要考虑具体使用的协议是什么

```ruby
require 'open-uri'

url = URI.parse("https://asd.com/saz.xml")
url.open {|f| puts f.read}
```

基本例子3：

当然， 也能加上一大堆头信息模拟请求. 如果有做爬虫的需求， 可以转向了解一下 `HTTParty` 这个 gem， 更容易使用。

```ruby
require 'open-uri'
# 假装一下user-agent
f = URI.open('https://www.apress.com/sitemap.xml',
         {'User-Agent' => 'Mozilla/5.0 (platform; rv:geckoversion) Gecko/
          geckotrail Firefox/firefoxversion'})
puts f.read
```